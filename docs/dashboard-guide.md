# ë©€í‹° ì—ì´ì „íŠ¸ í‰ê°€ ì§€í‘œ ëŒ€ì‹œë³´ë“œ

## ê°œìš”

ì´ ëŒ€ì‹œë³´ë“œëŠ” ë©€í‹° ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œì˜ í‰ê°€ ì§€í‘œë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³  ë¶„ì„í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. í”„ë¡¬í”„íŠ¸ ìµœì í™”ë¥¼ ìœ„í•œ í•µì‹¬ ì§€í‘œë“¤ì„ ì‹œê°í™”í•˜ì—¬ ì‹œìŠ¤í…œ ì„±ëŠ¥ì„ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

### ğŸ“Š ì „ì²´ í‰ê°€ ì§€í‘œ ê°œìš”
- **í‰ê·  í‰ê°€ ì ìˆ˜**: ì „ì²´ ì‹œìŠ¤í…œì˜ í‰ê·  í‰ê°€ ì ìˆ˜ (0-1)
- **í•©ê²©ë¥ **: í‰ê°€ë¥¼ í†µê³¼í•œ ìš”ì²­ì˜ ë¹„ìœ¨
- **ì´ í‰ê°€ ê±´ìˆ˜**: ìµœê·¼ 5ë¶„ê°„ ì²˜ë¦¬ëœ í‰ê°€ ê±´ìˆ˜
- **í˜„ì¬ í”„ë¡¬í”„íŠ¸ ë²„ì „**: í™œì„±í™”ëœ í”„ë¡¬í”„íŠ¸ì˜ ë²„ì „
- **í‰ê·  ì‘ë‹µ ì‹œê°„**: Workerì˜ í‰ê·  ì‘ë‹µ ì‹œê°„ (ms)
- **ìµœì í™” ì‹¤í–‰ íšŸìˆ˜**: í”„ë¡¬í”„íŠ¸ ìµœì í™”ê°€ ìˆ˜í–‰ëœ ì´ íšŸìˆ˜

### ğŸ“ˆ í‰ê°€ ì ìˆ˜ íŠ¸ë Œë“œ
- **í‰ê°€ ì ìˆ˜ ì‹œê³„ì—´**: Task Typeë³„ í‰ê°€ ì ìˆ˜ì˜ ì‹œê°„ì— ë”°ë¥¸ ë³€í™”
- **í‰ê°€ ì ìˆ˜ ë¶„í¬**: ì ìˆ˜ êµ¬ê°„ë³„ ë¶„í¬ (íˆìŠ¤í† ê·¸ë¨)
- **í•©ê²©/ë¶ˆí•©ê²© ì¶”ì´**: Pass/Fail ê±´ìˆ˜ì˜ ì‹œê°„ë³„ ì¶”ì´
- **í•©ê²©/ë¶ˆí•©ê²© ë¹„ìœ¨**: ìµœê·¼ 1ì‹œê°„ ë°ì´í„° ê¸°ë°˜ íŒŒì´ ì°¨íŠ¸
- **Task Typeë³„ í‰ê·  ì ìˆ˜**: Task Typeë³„ ì„±ëŠ¥ ë¹„êµ (ë°” ê²Œì´ì§€)

### ğŸ” ìƒì„¸ í‰ê°€ ë©”íŠ¸ë¦­
- **Rule Score vs LLM Score ë¹„êµ**: ê·œì¹™ ê¸°ë°˜ ì ìˆ˜ì™€ LLM ê¸°ë°˜ ì ìˆ˜ì˜ ì‹œê³„ì—´ ë¹„êµ
- **ì‘ë‹µ ì‹œê°„ ì¶”ì´**: P50, P95, P99 ë°±ë¶„ìœ„ìˆ˜ ë ˆì´í„´ì‹œ
- **ìµœê·¼ 1ì‹œê°„ ì‹¤íŒ¨ìœ¨**: ì‹¤íŒ¨í•œ ìš”ì²­ì˜ ë¹„ìœ¨
- **ì—ëŸ¬ ë°œìƒ ê±´ìˆ˜**: ì‹œìŠ¤í…œ ì—ëŸ¬ê°€ ë°œìƒí•œ ìš”ì²­ ìˆ˜
- **í‰ê·  Rule Score / LLM Score**: ê° í‰ê°€ ë°©ì‹ì˜ í‰ê·  ì ìˆ˜
- **ì„œë¹„ìŠ¤ë³„ ìš”ì²­ ì²˜ë¦¬ìœ¨**: Manager, Worker, Evaluatorì˜ ìš”ì²­ ì²˜ë¦¬ ì†ë„

### ğŸ“‹ ìµœê·¼ ì‹¤í–‰ ë¡œê·¸ ë° ìƒì„¸ ì •ë³´
- **ìµœê·¼ ì‹¤í–‰ ë¡œê·¸ (100ê±´)**: 
  - Request ID, Task Type, í”„ë¡¬í”„íŠ¸ ë²„ì „
  - í•©ê²©/ë¶ˆí•©ê²© ìƒíƒœ (ì‹œê°ì  í‘œì‹œ)
  - í‰ê°€ ì ìˆ˜, Rule Score, LLM Score
  - ì‘ë‹µ ì‹œê°„, ì—ëŸ¬ ì—¬ë¶€
  - ì…ë ¥/ì¶œë ¥ ë¯¸ë¦¬ë³´ê¸°
  - ìƒì„± ì‹œê°„

- **ì‹¤íŒ¨ ì¼€ì´ìŠ¤ ë¶„ì„**:
  - Task Typeë³„ ì‹¤íŒ¨ ê±´ìˆ˜
  - í‰ê·  ì ìˆ˜ ë° ì„¸ë¶€ ì ìˆ˜
  - ìµœì‹  í”„ë¡¬í”„íŠ¸ ë²„ì „

- **ìµœì í™” ì´ë ¥**:
  - í”„ë¡¬í”„íŠ¸ ë²„ì „ ë³€ê²½ ê¸°ë¡
  - ê°œì„ ìœ¨ (%)
  - íŠ¸ë¦¬ê±° ì£¼ì²´ (cronjob/manual)

### ğŸ¯ í”„ë¡¬í”„íŠ¸ ë²„ì „ ê´€ë¦¬
- **í”„ë¡¬í”„íŠ¸ ë²„ì „ë³„ í‰ê·  ì ìˆ˜ ì¶”ì´**: ê° ë²„ì „ì˜ ì„±ëŠ¥ ë³€í™” ì¶”ì 
- **í™œì„± í”„ë¡¬í”„íŠ¸ ëª©ë¡**: í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ í”„ë¡¬í”„íŠ¸ ì •ë³´

## API ì—”ë“œí¬ì¸íŠ¸

ëŒ€ì‹œë³´ë“œëŠ” ë‹¤ìŒ APIë¥¼ í™œìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤:

### Evaluator Stats API

ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ëŠ” `http://evaluator-service:8002/api/v1/stats/` ê²½ë¡œì— ìˆìŠµë‹ˆë‹¤.

#### 1. í‰ê°€ ì§€í‘œ ìš”ì•½
```bash
GET /stats/summary?hours=24&task_type=code_generation
```

**Response:**
```json
{
  "time_range_hours": 24,
  "task_type": "code_generation",
  "total_count": 150,
  "pass_count": 120,
  "fail_count": 30,
  "pass_rate": 0.8,
  "avg_score": 0.7654,
  "avg_latency_ms": 1234.56,
  "error_count": 5
}
```

#### 2. Task Typeë³„ í†µê³„
```bash
GET /stats/by-task-type?hours=24
```

**Response:**
```json
{
  "time_range_hours": 24,
  "stats": [
    {
      "task_type": "code_generation",
      "total_count": 100,
      "pass_count": 85,
      "fail_count": 15,
      "pass_rate": 0.85,
      "avg_score": 0.7821,
      "avg_latency_ms": 1200.45
    }
  ]
}
```

#### 3. ì ìˆ˜ ë¶„í¬
```bash
GET /stats/score-distribution?hours=24&task_type=code_generation
```

**Response:**
```json
{
  "time_range_hours": 24,
  "task_type": "code_generation",
  "distribution": [
    {"range": "0.0-0.3", "count": 5},
    {"range": "0.3-0.5", "count": 10},
    {"range": "0.5-0.7", "count": 25},
    {"range": "0.7-0.9", "count": 40},
    {"range": "0.9-1.0", "count": 20}
  ]
}
```

#### 4. ìµœê·¼ ì‹¤íŒ¨ ì¼€ì´ìŠ¤
```bash
GET /stats/recent-failures?limit=20&task_type=code_generation
```

#### 5. í”„ë¡¬í”„íŠ¸ ë²„ì „ë³„ ì„±ëŠ¥
```bash
GET /stats/prompt-performance?hours=24&task_type=code_generation
```

**Response:**
```json
{
  "time_range_hours": 24,
  "task_type": "code_generation",
  "performance": [
    {
      "prompt_version": 1,
      "task_type": "code_generation",
      "total_count": 50,
      "pass_count": 35,
      "pass_rate": 0.7,
      "avg_score": 0.6543,
      "avg_latency_ms": 1300.23
    },
    {
      "prompt_version": 2,
      "task_type": "code_generation",
      "total_count": 50,
      "pass_count": 45,
      "pass_rate": 0.9,
      "avg_score": 0.8321,
      "avg_latency_ms": 1150.67
    }
  ]
}
```

## ì ‘ì† ë°©ë²•

### ë¡œì»¬ í™˜ê²½
```bash
# Docker Composeë¡œ ì‹¤í–‰
docker-compose -f docker-compose.monitoring.yml up -d

# Grafana ì ‘ì†
open http://localhost:3000
```

ê¸°ë³¸ ë¡œê·¸ì¸ ì •ë³´:
- Username: `admin`
- Password: `admin`

### Kubernetes í™˜ê²½
```bash
# ëŒ€ì‹œë³´ë“œ ë°°í¬
kubectl apply -f k8s/monitoring/

# Port forwarding
kubectl port-forward -n monitoring svc/grafana 3000:3000

# ì ‘ì†
open http://localhost:3000
```

## ëŒ€ì‹œë³´ë“œ ì‚¬ìš© íŒ

### 1. ì‹œê°„ ë²”ìœ„ ì¡°ì •
- ìš°ì¸¡ ìƒë‹¨ì—ì„œ ì‹œê°„ ë²”ìœ„ ì„ íƒ (Last 6 hours, Last 24 hours ë“±)
- ìë™ ìƒˆë¡œê³ ì¹¨ ê°„ê²© ì„¤ì • (30ì´ˆ ê¶Œì¥)

### 2. Task Type í•„í„°ë§
- ìƒë‹¨ì˜ `task_type` ë“œë¡­ë‹¤ìš´ì—ì„œ íŠ¹ì • íƒœìŠ¤í¬ë§Œ í•„í„°ë§
- "All"ì„ ì„ íƒí•˜ë©´ ì „ì²´ ë°ì´í„° í‘œì‹œ

### 3. íŒ¨ë„ ìƒí˜¸ì‘ìš©
- ê·¸ë˜í”„ í´ë¦­: íŠ¹ì • ì‹œê°„ëŒ€ í™•ëŒ€
- ë²”ë¡€ í´ë¦­: íŠ¹ì • ì‹œë¦¬ì¦ˆ í‘œì‹œ/ìˆ¨ê¹€
- í…Œì´ë¸” í—¤ë” í´ë¦­: ì •ë ¬ ê¸°ì¤€ ë³€ê²½

### 4. ì•Œë¦¼ ì„¤ì •
ì ìˆ˜ê°€ ì„ê³„ê°’ ì´í•˜ë¡œ ë–¨ì–´ì§ˆ ë•Œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
1. íŒ¨ë„ì˜ "Edit" í´ë¦­
2. "Alert" íƒ­ ì„ íƒ
3. ì¡°ê±´ ì„¤ì • (ì˜ˆ: avg_score < 0.5)
4. ì•Œë¦¼ ì±„ë„ ì—°ê²° (Slack, Email ë“±)

## í‰ê°€ ì§€í‘œ í•´ì„ ê°€ì´ë“œ

### í‰ê°€ ì ìˆ˜ (Evaluation Score)
- **0.7 ì´ìƒ (ë…¹ìƒ‰)**: ìš°ìˆ˜ - í”„ë¡¬í”„íŠ¸ê°€ íš¨ê³¼ì ìœ¼ë¡œ ë™ì‘
- **0.5-0.7 (ë…¸ë€ìƒ‰)**: ë³´í†µ - ê°œì„  ì—¬ì§€ ìˆìŒ
- **0.5 ë¯¸ë§Œ (ë¹¨ê°„ìƒ‰)**: ë¶€ì¡± - í”„ë¡¬í”„íŠ¸ ìµœì í™” í•„ìš”

### í•©ê²©ë¥  (Pass Rate)
- **80% ì´ìƒ**: ê±´ê°•í•œ ìƒíƒœ
- **60-80%**: ì£¼ì˜ í•„ìš”
- **60% ë¯¸ë§Œ**: ì¦‰ì‹œ ê°œì„  í•„ìš”

### Rule Score vs LLM Score
- **Rule Score**: ê°ê´€ì  ê²€ì¦ (ë¬¸ë²•, êµ¬ì¡°, í˜•ì‹)
- **LLM Score**: ì˜ë¯¸ì  í’ˆì§ˆ í‰ê°€ (ì •í™•ì„±, ê´€ë ¨ì„±)
- ë‘ ì ìˆ˜ì˜ ì°¨ì´ê°€ í¬ë©´ íŠ¹ì • ì˜ì—­ì— ë¬¸ì œê°€ ìˆìŒì„ ì‹œì‚¬

### ì‘ë‹µ ì‹œê°„ (Latency)
- **P50 < 1ì´ˆ**: ì–‘í˜¸
- **P95 < 3ì´ˆ**: ëŒ€ë¶€ë¶„ì˜ ìš”ì²­ì´ ë¹ ë¥´ê²Œ ì²˜ë¦¬
- **P99 > 5ì´ˆ**: ì¼ë¶€ ìš”ì²­ì—ì„œ ë³‘ëª© ë°œìƒ ê°€ëŠ¥

## í”„ë¡¬í”„íŠ¸ ìµœì í™” ì›Œí¬í”Œë¡œìš°

1. **ëª¨ë‹ˆí„°ë§**: ëŒ€ì‹œë³´ë“œì—ì„œ í‰ê°€ ì ìˆ˜ ë° í•©ê²©ë¥  ì¶”ì 
2. **ë¶„ì„**: ì‹¤íŒ¨ ì¼€ì´ìŠ¤ ë° ë‚®ì€ ì ìˆ˜ì˜ íŒ¨í„´ íŒŒì•…
3. **ìµœì í™”**: Optimizerê°€ ìë™ìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ ê°œì„  ë˜ëŠ” ìˆ˜ë™ ìˆ˜ì •
4. **ê²€ì¦**: ìƒˆ í”„ë¡¬í”„íŠ¸ ë²„ì „ì˜ ì„±ëŠ¥ì„ ì´ì „ ë²„ì „ê³¼ ë¹„êµ
5. **ë°°í¬**: ì„±ëŠ¥ì´ ê°œì„ ë˜ë©´ í™œì„±í™”

## ë¬¸ì œ í•´ê²°

### ë°ì´í„°ê°€ í‘œì‹œë˜ì§€ ì•ŠëŠ” ê²½ìš°
1. Prometheusì™€ PostgreSQLì´ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸
   ```bash
   kubectl get pods -n monitoring
   ```

2. ë°ì´í„° ì†ŒìŠ¤ ì—°ê²° í™•ì¸
   - Grafana > Configuration > Data Sources
   - Prometheusì™€ PostgreSQLì´ "Working" ìƒíƒœì¸ì§€ í™•ì¸

3. ì‹¤í–‰ ë¡œê·¸ê°€ DBì— ì €ì¥ë˜ëŠ”ì§€ í™•ì¸
   ```bash
   # PostgreSQLì— ì ‘ì†
   kubectl exec -it postgres-0 -- psql -U agent_user -d agent_db
   
   # ë¡œê·¸ í™•ì¸
   SELECT COUNT(*) FROM execution_logs;
   ```

### ê·¸ë˜í”„ê°€ ê¹¨ì§€ëŠ” ê²½ìš°
- ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ
- ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨
- Grafana ì¬ì‹œì‘

### ëŠë¦° ì¿¼ë¦¬ ì„±ëŠ¥
- PostgreSQL ì¸ë±ìŠ¤ í™•ì¸ ë° ìƒì„±
- ì‹œê°„ ë²”ìœ„ë¥¼ ì¤„ì—¬ì„œ í…ŒìŠ¤íŠ¸
- ì§‘ê³„ ê°„ê²© ì¡°ì • (ì˜ˆ: 1ë¶„ â†’ 5ë¶„)

## ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- [Grafana ê³µì‹ ë¬¸ì„œ](https://grafana.com/docs/)
- [Prometheus ì¿¼ë¦¬ ê°€ì´ë“œ](https://prometheus.io/docs/prometheus/latest/querying/basics/)
- [í”„ë¡œì íŠ¸ Self-Healing ë¦¬í¬íŠ¸](../docs/self-healing-report.md)

## ê¸°ì—¬

ëŒ€ì‹œë³´ë“œ ê°œì„  ì•„ì´ë””ì–´ë‚˜ ë²„ê·¸ ë¦¬í¬íŠ¸ëŠ” ì´ìŠˆë¡œ ë“±ë¡í•´ì£¼ì„¸ìš”.

